# ПЛАН РАЗРАБОТКИ ПРИЛОЖЕНИЯ OptStroy Sistem

## ОБЩАЯ АРХИТЕКТУРА

### Структура проекта:
- **MainWindow.xaml** - главное окно с Frame для навигации
- **Pages/** - папка со всеми страницами приложения
- **Class/** - вспомогательные классы (модели, валидаторы, хелперы)
- **AppData/** - работа с БД (Entity Framework контекст)
- **Sourses/Sprites/** - изображения товаров

---

## ЭТАП 1: ИНФРАСТРУКТУРА И БАЗОВЫЕ КОМПОНЕНТЫ

### 1.1 Настройка подключения к БД
- [ ] Реализовать `AppConnect.cs` - статический класс с экземпляром `Entities1`
- [ ] Настроить строку подключения в `App.Config`
- [ ] Создать папку `ProductImages` для хранения изображений товаров

### 1.2 Система навигации
- [ ] Реализовать `AppFrame.cs` - статический класс для управления Frame
- [ ] Настроить `MainWindow.xaml` с Frame и меню навигации
- [ ] Создать базовую структуру меню (для разных ролей)

### 1.3 Система управления пользователями и ролями
- [ ] Создать `Class/CurrentUser.cs` - класс для хранения текущего пользователя
- [ ] Создать `Class/UserManager.cs` - класс для работы с пользователями (регистрация, авторизация)
- [ ] Реализовать хеширование паролей (MD5 или SHA256)
- [ ] Создать перечисление ролей или использовать БД

---

## ЭТАП 2: СТРАНИЦЫ АВТОРИЗАЦИИ И РЕГИСТРАЦИИ

### 2.1 Страница входа (LoginPage.xaml)
- [ ] Создать страницу авторизации
- [ ] Поля: Email/Телефон, Пароль
- [ ] Кнопка "Войти"
- [ ] Ссылка на регистрацию
- [ ] Валидация полей ввода

### 2.2 Страница регистрации (RegisterPage.xaml)
- [ ] Создать страницу регистрации
- [ ] Поля: ФИО, Email, Телефон, Пароль, Подтверждение пароля
- [ ] Валидация:
  - Email (формат)
  - Телефон (формат)
  - Пароль (минимальная длина, совпадение)
  - Уникальность Email и Телефона
- [ ] Роль "Пользователь" по умолчанию
- [ ] Кнопка "Зарегистрироваться"

---

## ЭТАП 3: ГЛАВНОЕ ОКНО И НАВИГАЦИЯ

### 3.1 MainWindow.xaml
- [ ] Создать интерфейс с:
  - Меню навигации (слева или сверху)
  - Frame для отображения страниц
  - Блок информации о пользователе (справа вверху)
  - Кнопка выхода
- [ ] Адаптивный дизайн

### 3.2 Система меню по ролям
- [ ] **Гость**: только "Вход" и "Регистрация"
- [ ] **Пользователь**: Каталог, Корзина, Мои заказы, Личный кабинет
- [ ] **Менеджер**: + Управление товарами, Управление поставщиками, Управление заказами
- [ ] **Администратор**: + Управление пользователями

---

## ЭТАП 4: КАТАЛОГ ТОВАРОВ (ListView)

### 4.1 Страница каталога (CatalogPage.xaml)
- [ ] Создать страницу с ListView для отображения товаров
- [ ] Колонки ListView:
  - Изображение товара
  - Название
  - Описание
  - Цена (с учетом скидки)
  - Старая цена (зачеркнутая, если есть)
  - Процент скидки
  - Характеристики
  - Поставщик
  - Кнопка "В корзину"
- [ ] Визуальное выделение товаров с ценой > 1000:
  - Другой цвет фона
  - Жирный шрифт
  - Иконка (опционально)

### 4.2 Функционал каталога
- [ ] Фильтрация товаров (по поставщику, цене, названию)
- [ ] Сортировка (по цене, названию, поставщику)
- [ ] Поиск по названию/описанию
- [ ] Отображение только активных товаров (IsActive = 1)

### 4.3 ViewModel для каталога
- [ ] Создать `Class/CatalogViewModel.cs` (опционально, если используем MVVM)
- [ ] Или реализовать логику в code-behind

---

## ЭТАП 5: КОРЗИНА

### 5.1 Страница корзины (CartPage.xaml)
- [ ] Создать страницу корзины
- [ ] Отображение товаров в корзине (ListView или DataGrid)
- [ ] Колонки:
  - Изображение
  - Название
  - Количество (с возможностью изменения)
  - Цена за единицу
  - Общая стоимость позиции
  - Кнопка удаления
- [ ] Отображение общей суммы корзины
- [ ] Кнопка "Оформить заказ"
- [ ] Кнопка "Очистить корзину"

### 5.2 Логика корзины
- [ ] Добавление товара в корзину (создание/обновление Cart и CartItems)
- [ ] Изменение количества товара
- [ ] Удаление товара из корзины
- [ ] Расчет общей стоимости
- [ ] Сохранение цены на момент добавления (PriceAtMoment)

---

## ЭТАП 6: ОФОРМЛЕНИЕ ЗАКАЗА

### 6.1 Страница оформления заказа (OrderPage.xaml)
- [ ] Создать страницу оформления заказа
- [ ] Отображение товаров из корзины (только для просмотра)
- [ ] Поле ввода адреса доставки
- [ ] Отображение итоговой суммы
- [ ] Кнопка "Подтвердить заказ"
- [ ] Кнопка "Отмена"

### 6.2 Логика создания заказа
- [ ] Генерация уникального номера заказа (OrderNumber)
- [ ] Создание записи в таблице Orders
- [ ] Создание записей в OrderItems для каждого товара
- [ ] Очистка корзины после создания заказа
- [ ] Переход на страницу истории заказов

---

## ЭТАП 7: ИСТОРИЯ ЗАКАЗОВ

### 7.1 Страница истории заказов (OrderHistoryPage.xaml)
- [ ] Создать страницу истории заказов
- [ ] Отображение заказов текущего пользователя (ListView или DataGrid)
- [ ] Колонки:
  - Номер заказа
  - Дата заказа
  - Адрес доставки
  - Статус
  - Общая стоимость
  - Кнопка "Детали"
- [ ] Фильтрация по статусу, дате

### 7.2 Страница деталей заказа (OrderDetailsPage.xaml)
- [ ] Создать страницу деталей заказа
- [ ] Отображение всех товаров в заказе
- [ ] Полная информация о заказе

---

## ЭТАП 8: ЛИЧНЫЙ КАБИНЕТ

### 8.1 Страница личного кабинета (ProfilePage.xaml)
- [ ] Создать страницу личного кабинета
- [ ] Отображение данных пользователя:
  - ФИО (редактируемое)
  - Email (не редактируемое, только просмотр)
  - Телефон (редактируемое)
  - Роль (только просмотр)
- [ ] Кнопка "Сохранить изменения"
- [ ] Валидация при редактировании

---

## ЭТАП 9: УПРАВЛЕНИЕ ТОВАРАМИ (Менеджер/Админ)

### 9.1 Страница управления товарами (ProductsManagementPage.xaml)
- [ ] Создать страницу управления товарами
- [ ] DataGrid со всеми товарами
- [ ] Кнопки: "Добавить", "Редактировать", "Удалить" (только для Админа)
- [ ] Фильтрация и поиск

### 9.2 Окно добавления/редактирования товара (ProductEditWindow.xaml)
- [ ] Создать окно для редактирования товара
- [ ] Поля:
  - Название
  - Описание
  - Цена
  - Старая цена (опционально)
  - Процент скидки (опционально)
  - Характеристики
  - Поставщик (ComboBox)
  - Изображение (кнопка загрузки через OpenFileDialog)
- [ ] Логика загрузки изображения:
  - OpenFileDialog для выбора файла
  - Копирование в папку ProductImages
  - Сохранение относительного пути в БД
- [ ] Валидация всех полей
- [ ] Кнопки "Сохранить" и "Отмена"

---

## ЭТАП 10: УПРАВЛЕНИЕ ПОСТАВЩИКАМИ (Менеджер/Админ)

### 10.1 Страница управления поставщиками (SuppliersManagementPage.xaml)
- [ ] Создать страницу управления поставщиками
- [ ] DataGrid со всеми поставщиками
- [ ] Кнопки: "Добавить", "Редактировать", "Удалить" (только для Админа)
- [ ] Простая форма добавления/редактирования

---

## ЭТАП 11: УПРАВЛЕНИЕ ЗАКАЗАМИ (Менеджер/Админ)

### 11.1 Страница управления заказами (OrdersManagementPage.xaml)
- [ ] Создать страницу управления заказами
- [ ] DataGrid со всеми заказами
- [ ] Возможность изменения статуса заказа
- [ ] Просмотр деталей заказа
- [ ] Фильтрация по статусу, пользователю, дате

---

## ЭТАП 12: УПРАВЛЕНИЕ ПОЛЬЗОВАТЕЛЯМИ (Только Админ)

### 12.1 Страница управления пользователями (UsersManagementPage.xaml)
- [ ] Создать страницу управления пользователями
- [ ] DataGrid со всеми пользователями
- [ ] Кнопки: "Добавить", "Редактировать", "Удалить", "Изменить роль"
- [ ] Окно редактирования пользователя с возможностью изменения роли
- [ ] Валидация при редактировании

---

## ЭТАП 13: ВАЛИДАЦИЯ И ОБРАБОТКА ОШИБОК

### 13.1 Валидация данных
- [ ] Создать `Class/Validators.cs` - класс с методами валидации:
  - Валидация Email
  - Валидация телефона
  - Валидация пароля
  - Валидация обязательных полей
- [ ] Применение валидации во всех формах

### 13.2 Обработка ошибок
- [ ] Глобальная обработка исключений в App.xaml.cs
- [ ] Обработка ошибок при удалении товара с заказами:
  - Проверка наличия товара в OrderItems
  - Понятное сообщение об ошибке
- [ ] Обработка ошибок БД
- [ ] Отображение ошибок пользователю (MessageBox или Snackbar)

---

## ЭТАП 14: ДОПОЛНИТЕЛЬНЫЕ УЛУЧШЕНИЯ

### 14.1 UI/UX улучшения
- [ ] Стилизация приложения (цветовая схема, шрифты)
- [ ] Иконки для кнопок и меню
- [ ] Анимации переходов между страницами (опционально)
- [ ] Адаптивность интерфейса

### 14.2 Функциональные улучшения
- [ ] Подсчет количества товаров в корзине (в меню)
- [ ] Автоматическое обновление данных после изменений
- [ ] Подтверждение удаления записей
- [ ] Экспорт данных (опционально)

---

## ТЕХНИЧЕСКИЕ ДЕТАЛИ

### Используемые технологии:
- WPF (.NET Framework 3.5)
- Entity Framework (Database First)
- SQL Server (через Entity Framework)

### Структура классов:
```
Practice2025One/
├── AppData/
│   ├── AppConnect.cs (Entities1 контекст)
│   ├── AppFrame.cs (управление Frame)
│   └── Model1.edmx (EF модель)
├── Class/
│   ├── CurrentUser.cs (текущий пользователь)
│   ├── UserManager.cs (работа с пользователями)
│   └── Validators.cs (валидация)
├── Pages/
│   ├── LoginPage.xaml
│   ├── RegisterPage.xaml
│   ├── CatalogPage.xaml
│   ├── CartPage.xaml
│   ├── OrderPage.xaml
│   ├── OrderHistoryPage.xaml
│   ├── ProfilePage.xaml
│   ├── ProductsManagementPage.xaml
│   ├── SuppliersManagementPage.xaml
│   ├── OrdersManagementPage.xaml
│   └── UsersManagementPage.xaml
├── ProductImages/ (папка для изображений)
├── MainWindow.xaml
└── App.xaml
```

### Важные моменты:
1. Все страницы наследуются от `Page`
2. Навигация через `AppFrame.MainFrame.Navigate()`
3. Текущий пользователь хранится в `CurrentUser`
4. Все операции с БД через `AppConnect.Model1`
5. Изображения товаров сохраняются в `ProductImages/` с относительным путем в БД

---

## ПОРЯДОК РЕАЛИЗАЦИИ (рекомендуемый)

1. **Этап 1** - Инфраструктура (AppConnect, AppFrame, MainWindow)
2. **Этап 2** - Авторизация и регистрация
3. **Этап 3** - Главное окно и навигация
4. **Этап 4** - Каталог товаров (основной функционал)
5. **Этап 5** - Корзина
6. **Этап 6** - Оформление заказа
7. **Этап 7** - История заказов
8. **Этап 8** - Личный кабинет
9. **Этап 9-12** - Управление данными (Менеджер/Админ)
10. **Этап 13** - Валидация и обработка ошибок
11. **Этап 14** - Финальная полировка

---

## ПРОВЕРКА ТРЕБОВАНИЙ

### Функциональные требования:
- [x] F1. Управление пользователями (регистрация, авторизация, личный кабинет)
- [x] F2. Система ролей и прав доступа (Гость, Пользователь, Менеджер, Администратор)
- [x] F3. Визуализация и бизнес-логика (выделение товаров > 1000, скидки, загрузка изображений)
- [x] F4. Валидация и обработка ошибок (контроль целостности, валидация полей, глобальная обработка)

### Технические требования:
- [x] Главное окно с Frame для навигации
- [x] Страницы в папке Pages
- [x] Каталог на ListView
- [x] Работа с БД через Entity Framework

